<!--
    ìˆ˜ì •ì¼ : 2025/11/29
    ìˆ˜ì •ì : ì²œìˆ˜ë¹ˆ
    ë‚´ìš© : ì€í–‰ì†Œê°œ ë©”ì¸ UI*UX ë³€ê²½
-->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>ë”¸ê¹ì€í–‰::ì€í–‰ì†Œê°œ</title>

    <link rel="stylesheet" th:href="@{/css/common/style_common.css}">
    <link rel="stylesheet" th:href="@{/css/common/style_font.css}">
    <link href="//cdn.jsdelivr.net/xeicon/2/xeicon.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/company/_coheader.css}">
    <link rel="stylesheet" th:href="@{/css/company/_cofooter.css}">
    <link rel="stylesheet" th:href="@{/css/company/main.css}">
    <link rel="stylesheet" th:href="@{/css/member/AutoLogout.css}">

    <!-- ë¹„íŠ¸ì½”ì¸ ì´ë²¤íŠ¸ ìš© css -->
    <style>
        /* ë¹„íŠ¸ì½”ì¸ ì´ë²¤íŠ¸ */
        #bitcoinModal {
            cursor: pointer;
            display: none;
            position: fixed;
            bottom: 0;
            right: 50px;
            z-index: 1000;
        }
        .active {
            display: block !important;

            bottom: 100px;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateY(-50px);
            }
        }

        .animate-slideUp {
            animation: slideUp 1s ease-out forwards;
        }

        @media (min-width: 1536px) {
            .container {
                max-width: 1280px !important;
            }
        }
    </style>
    <script th:src="@{/js/company/coGlobalBtn.js}" defer></script>
    <script th:src="@{/js/translate.js}" defer></script>
    <script th:src="@{/js/searchOverlay.js}" defer></script>
    <script th:src="@{/js/member/session-timer.js}" defer></script>

    <!-- ë¹„íŠ¸ì½”ì¸ ì´ë²¤íŠ¸ ìš© js ì•„ë˜ 2ê°œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById("bitcoinModal");
            const openBtn = document.getElementById("openModal");

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë‹¬ ë³´ì´ê²Œ
            modal.classList.add("active");
            modal.classList.add("animate-slideUp");
            yesterdayAndTodayPrice();

            // í´ë¦­í•˜ë©´ ë‹«ê¸°
            openBtn.addEventListener("click", () => {
                modal.classList.remove("active");
                modal.classList.remove("animate-slideUp");
            });

            async function yesterdayAndTodayPrice() {
                try {
                    const response = await fetch(`/busanbank/api/coin/history/btc/yesterdayAndToday?symbol=BTC`);
                    const json = await response.json();
                    console.log(json);

                    const yesterday = json[0].price;
                    const today = json[1].price;
                    console.log(`yesterday = ${yesterday}, today = ${today}`);

                    document.getElementById('priceDisplay').textContent = Math.round(yesterday) + ' USD';
                } catch (error) {
                    console.error('ê°€ê²© ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                }
            }

            let result = '';
            const upBtn = document.getElementById('up_btn');
            const downBtn = document.getElementById('down_btn');

            // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            upBtn.addEventListener("click", () => checkResult("up"));
            downBtn.addEventListener("click", () => checkResult("down"));

            async function checkResult(choice) {
                try {
                    const response = await fetch(`/busanbank/api/coin/history/btc/yesterdayAndToday?symbol=BTC`);
                    const json = await response.json();
                    console.log(json);

                    const yesterday = json[0].price;
                    const today = json[1].price;

                    console.log(`yesterday = ${yesterday}, today = ${today}`);

                    const actual = yesterday < today ? "up" : "down";

                    if (choice === actual) {
                        console.log("ì„±ê³µ");

                        fetch("/busanbank/company/btcEvent", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ result: "success" })
                        })
                        .then(res => res.text())
                        .then(msg => {
                            console.log("ì„œë²„ ì‘ë‹µ:", msg);
                            showSuccessModal(yesterday,today);
                        });
                    } else {
                        fetch("/busanbank/company/btcEvent", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ result: "fail" })
                        })
                        .then(msg => {
                            console.log("ì‹¤íŒ¨");
                            showFailModal(yesterday, today);
                        });
                    }

                    document.getElementById('priceDisplay').textContent = Math.round(yesterday) + ' USD';

                } catch (error) {
                    console.error('ê°€ê²© ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                }
            }

            function showSuccessModal(yesterday, today) {
                const modal = document.getElementById('bitcoinModal');
                const priceChange = ((today - yesterday) / yesterday * 100).toFixed(2);

                modal.innerHTML = `
                    <!-- Close Button -->
                    <button onclick="location.reload()" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 transition">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>

                    <!-- Success Animation -->
                    <div class="text-center mb-6">
                        <div class="text-8xl mb-4 animate-bounce">ğŸ‰</div>
                        <div class="flex justify-center gap-4 mb-4">
                            <span class="text-5xl animate-pulse">âœ¨</span>
                            <span class="text-5xl animate-pulse" style="animation-delay: 0.2s">ğŸŠ</span>
                            <span class="text-5xl animate-pulse" style="animation-delay: 0.4s">âœ¨</span>
                        </div>
                    </div>

                    <!-- Success Message -->
                    <div class="text-center mb-6">
                        <h2 class="text-3xl font-bold text-green-600 mb-3">ì˜ˆì¸¡ ì„±ê³µ!</h2>
                        <p class="text-gray-600 text-lg mb-4">ì¶•í•˜í•©ë‹ˆë‹¤! ì •í™•í•˜ê²Œ ì˜ˆì¸¡í•˜ì…¨ì–´ìš”</p>

                        <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 mb-4">
                            <p class="text-gray-600 text-sm mb-2">ê°€ê²© ë³€ë™</p>
                            <p class="text-2xl font-bold text-green-600 mb-1">
                                ${Math.round(yesterday).toLocaleString()} â†’ ${Math.round(today).toLocaleString()} USD
                            </p>
                            <p id="priceChangeDisplay" class="text-green-600 font-semibold">
                                <i class="fa-solid fa-arrow-up"></i>
                            </p>
                        </div>

                        <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 mb-4">
                            <p class="text-yellow-800 font-bold text-lg">ğŸ ë¦¬ì›Œë“œ ì§€ê¸‰ ì™„ë£Œ!</p>
                        </div>
                    </div>

                    <!-- Close Button -->
                    <button id="rewardBtn" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white py-4 rounded-xl text-lg font-bold transition-all duration-200 transform hover:scale-105">
                        í™•ì¸
                    </button>

                    <style>
                        @keyframes pulse {
                            0%, 100% { transform: scale(1); opacity: 1; }
                            50% { transform: scale(1.1); opacity: 0.8; }
                        }
                        .animate-pulse {
                            animation: pulse 1s ease-in-out infinite;
                        }
                    </style>
                `;

                const priceChangeEl = document.getElementById("priceChangeDisplay");

                if (priceChange > 0) {
                    priceChangeEl.innerHTML = `
                        <i class="fa-solid fa-arrow-up"></i>
                    `;
                } else if (priceChange < 0) {
                    priceChangeEl.innerHTML = `
                        <i class="fa-solid fa-arrow-down"></i> ${priceChange}% í•˜ë½
                    `;
                }

                const rewardBtn = document.querySelector("#rewardBtn");
                rewardBtn.addEventListener("click", () => {
                    modal.classList.remove("active");
                });
            }

            function showFailModal(yesterday, today) {
                const modal = document.getElementById('bitcoinModal');
                const priceChange = ((today - yesterday) / yesterday * 100).toFixed(2);
                const isUp = today > yesterday;

                modal.innerHTML = `
                    <!-- Close Button -->
                    <button onclick="location.reload()" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 transition">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>

                    <!-- Fail Animation -->
                    <div class="text-center mb-6">
                        <div class="text-8xl mb-4">ğŸ˜¢</div>
                    </div>

                    <!-- Fail Message -->
                    <div class="text-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-800 mb-3">ì•„ì‰¬ì›Œìš”!</h2>
                        <p class="text-gray-600 text-lg mb-4">ë‹¤ìŒ ê¸°íšŒì— ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”</p>

                        <div class="bg-gradient-to-br from-gray-50 to-slate-50 rounded-2xl p-6 mb-4">
                            <p class="text-gray-600 text-sm mb-2">ì‹¤ì œ ê°€ê²© ë³€ë™</p>
                            <p class="text-2xl font-bold text-gray-800 mb-1">
                                ${Math.round(yesterday).toLocaleString()} â†’ ${Math.round(today).toLocaleString()} USD
                            </p>
                            <p class="${isUp ? 'text-green-600' : 'text-red-600'} font-semibold">
                                <i class="fa-solid fa-arrow-${isUp ? 'up' : 'down'}"></i> ${Math.abs(priceChange)}% ${isUp ? 'ìƒìŠ¹' : 'í•˜ë½'}
                            </p>
                        </div>
                    </div>

                    <!-- Close Button -->
                    <button id="failBtn" class="w-full bg-gradient-to-r from-gray-500 to-slate-600 hover:from-gray-600 hover:to-slate-700 text-white py-4 rounded-xl text-lg font-bold transition-all duration-200 transform hover:scale-105">
                        í™•ì¸
                    </button>
                `;

                const failBtn = document.querySelector("#failBtn");
                failBtn.addEventListener("click", () => {
                    modal.classList.remove("active");
                });
            }
        });
    </script>
</head>

<body>
    <!-- Header ë¶€ë¶„ -->
    <div th:replace="~{company/_coheader :: coHeaderFragment}"></div>

    <!-- MAIN CONTENT -->
    <main>
        <!-- ë°°ë„ˆ ì„¹ì…˜ (ì‚¬ì§„ë§Œ) -->
        <section class="banner-section">
            <div class="banner-content">
                <div class="banner-text">
                    <p class="banner-label">ì€í–‰ì†Œê°œ</p>
                    <h1 class="banner-title">
                        ê°€ì¥ ì‹ ë¢°ë°›ëŠ” ì€í–‰<br>
                        <strong>BNK ë¶€ì‚°ì€í–‰!</strong>
                    </h1>
                    <p class="banner-subtitle">
                        ê³ ê°ì„ í–¥í•œ ë‹¨ í•˜ë‚˜ì˜ ì§„ì‹¬<br>
                        ì§„ì‹¬ìœ¼ë¡œ ì„¬ê¸°ëŠ” ë§ˆìŒê°€ì§
                    </p>
                </div>
            </div>
        </section>

        <!-- ë¹ ë¥¸ ë©”ë‰´ ì¹´ë“œ ì„¹ì…˜ (ì•„ì´ì½˜ í¬í•¨) -->
        <section class="quick-cards-section">
            <div class="container">
                <div class="quick-cards-grid">
                    <a th:href="@{/company/companybankintro}" class="quick-card" style="text-decoration: none;">
                        <div class="quick-card-icon">ğŸ¦</div>
                        <h3>ì€í–‰ì•ˆë‚´</h3>
                    </a>
                    <a th:href="@{/company/companyinvest}" class="quick-card" style="text-decoration: none;">
                        <div class="quick-card-icon">ğŸ“Š</div>
                        <h3>íˆ¬ììì •ë³´</h3>
                    </a>
                    <a th:href="@{/company/companystory}" class="quick-card" style="text-decoration: none;">
                        <div class="quick-card-icon">ğŸ“–</div>
                        <h3>ì€í–‰ìŠ¤í† ë¦¬</h3>
                    </a>
                    <a th:href="@{/company/companymap}" class="quick-card" style="text-decoration: none;">
                        <div class="quick-card-icon">ğŸ“</div>
                        <h3>ì˜ì—…ì ì•ˆë‚´</h3>
                    </a>
                </div>
            </div>
        </section>

        <!-- ê³µì§€ì‚¬í•­/ë³´ë„ìë£Œ ì„¹ì…˜ -->
        <section class="cards-section">
            <div class="introduce-container">
                <div class="cards-grid">
                    <!-- ê³µì§€ì‚¬í•­ -->
                    <article class="info-card">
                        <div class="card-header">
                            <h3>ê³µì§€ì‚¬í•­ <i class="xi-angle-right-min" th:onclick="|location.href='@{/company/companystory}'|" style="cursor:pointer;"></i></h3>
                        </div>
                        <div class="card-body">
                            <ul class="sub-links" th:each="notice, iterStat : ${pageResponseDTO2.dtoList}">
                                <li th:if="${iterStat.index < 3}">
                                    <a th:href="@{/company/companystory/view(id=${notice.id}, boardType=${notice.boardType})}">[[${notice.title}]]</a>
                                    <span class="badge-new">N</span>
                                </li>
                            </ul>
                        </div>
                    </article>

                    <!-- ë³´ë„ìë£Œ -->
                    <article class="info-card">
                        <div class="card-header">
                            <h3>ë³´ë„ìë£Œ <i class="xi-angle-right-min" th:onclick="|location.href='@{/company/companystory}'|" style="cursor:pointer;"></i></h3>
                        </div>
                        <div class="card-body">
                            <ul class="sub-links" th:each="report, iterStat : ${pageResponseDTO1.dtoList}">
                                <li th:if="${iterStat.index < 3}">
                                    <a th:href="@{/company/companystory/view(id=${report.id}, boardType=${report.boardType})}">[[${report.title}]]</a>
                                    <span class="badge-new">N</span>
                                </li>
                            </ul>
                        </div>
                    </article>
                </div>
            </div>
        </section>
    </main>

    <!-- ë¹„íŠ¸ì½”ì¸ ì´ë²¤íŠ¸ ìš© modal -->
    <!-- Modal -->
    <div id="bitcoinModal" th:if="${showCouponModal}" class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 animate-slideUp">

        <!-- Close Button -->
        <button id="openModal" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 transition">
            <i class="fa-solid fa-xmark text-xl">x</i>
        </button>

        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-block bg-blue-50 rounded-full px-4 py-1 mb-4">
                <span class="text-blue-600 text-sm font-semibold">ğŸ íŠ¹ë³„ ì´ë²¤íŠ¸</span>
            </div>

            <h2 class="text-2xl font-bold text-gray-900 mb-2">ë¹„íŠ¸ì½”ì¸ ì˜ˆì¸¡ ì±Œë¦°ì§€</h2>
            <p class="text-gray-600 text-sm">ë‹¤ìŒ ì‹œì„¸ë¥¼ ì˜ˆì¸¡í•˜ê³  ë¦¬ì›Œë“œë¥¼ ë°›ì•„ê°€ì„¸ìš”!</p>
        </div>

        <!-- Stock Info -->
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 mb-6">
            <p id="priceDisplay" class="text-3xl font-bold text-gray-900 mb-1"></p>
            <p class="text-gray-500 text-xs">ì „ì¼ ì¢…ê°€</p>
        </div>

        <!-- Question -->
        <div class="text-center mb-6">
            <p class="text-gray-800 font-semibold text-lg">ë‹¤ìŒ ì‹œì„¸ëŠ” ì–´ë–»ê²Œ ë ê¹Œìš”?</p>
        </div>

        <!-- Selection Buttons -->
        <div class="grid grid-cols-2 gap-3 mb-6">

            <!-- ìƒìŠ¹ -->
            <button id="up_btn" class="group relative overflow-hidden bg-gradient-to-br from-green-500 to-emerald-600
                       hover:from-green-600 hover:to-emerald-700 text-white py-6 rounded-2xl
                       transition-all duration-200 transform hover:scale-105 shadow-md" th:value="up">
                <div class="flex flex-col items-center gap-2">
                    <i class="fa-solid fa-arrow-trend-up text-3xl"></i>
                    <span class="text-lg font-bold">ìƒìŠ¹</span>
                </div>
            </button>

            <!-- í•˜ë½ -->
            <button id="down_btn" class="group relative overflow-hidden bg-gradient-to-br from-red-500 to-rose-600
                       hover:from-red-600 hover:to-rose-700 text-white py-6 rounded-2xl
                       transition-all duration-200 transform hover:scale-105 shadow-md" th:value="down">
                <div class="flex flex-col items-center gap-2">
                    <i class="fa-solid fa-arrow-trend-down text-3xl"></i>
                    <span class="text-lg font-bold">í•˜ë½</span>
                </div>
            </button>
        </div>

        <!-- Footer -->
        <p class="text-center text-gray-400 text-xs">
            ì„ íƒ í›„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
        </p>
    </div>

    <!-- Footer ë¶€ë¶„ -->
    <div th:replace="~{company/_cofooter :: cofooterFragment(${appInfo})}"></div>
</body>
</html>