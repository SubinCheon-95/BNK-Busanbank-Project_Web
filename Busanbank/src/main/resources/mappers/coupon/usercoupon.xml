<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.busanbank.mapper.UserCouponMapper">

    <!-- üî• Flutter APIÏö©: ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïø†Ìè∞ Ï°∞Ìöå -->
    <select id="selectAvailableCoupons" resultType="kr.co.busanbank.dto.UserCouponDTO">
        SELECT
            UC.UCNO as ucNo,
            UC.USERNO as userNo,
            UC.COUPONNO as couponNo,
            C.COUPONNAME as couponName,
            C.BONUSRATE as bonusRate,
            C.CATEGORYID as categoryId,    -- ‚úÖ Ï∂îÍ∞Ä!
            UC.PRODUCTNO as productNo,
            UC.EXPIREDATE as expireDate,   -- ‚úÖ Ï∂îÍ∞Ä!
            UC.STATUS as status
        FROM USERCOUPON UC
                 INNER JOIN COUPON C ON UC.COUPONNO = C.COUPONNO
        WHERE UC.USERNO = #{userNo}
          AND UC.STATUS = 'A'
          AND C.CATEGORYID = 9             -- ‚úÖ 9Î≤à Ïπ¥ÌÖåÍ≥†Î¶¨Îßå!
        ORDER BY UC.EXPIREDATE ASC
    </select>

    <select id="findByUserNo" resultType="kr.co.busanbank.dto.UserCouponDTO">
        SELECT
            UC.UCNO,
            UC.USERNO,
            UC.COUPONNO,
            C.COUPONNAME,
            C.BONUSRATE,
            C.CATEGORYID,  -- ‚úÖ Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÏöî!
            UC.PRODUCTNO,
            UC.EXPIREDATE,
            UC.STATUS
        FROM USERCOUPON UC
                 INNER JOIN COUPON C ON UC.COUPONNO = C.COUPONNO
        WHERE UC.USERNO = #{userNo}
          AND UC.STATUS = 'A'  -- ÌôúÏÑ± Ïø†Ìè∞Îßå
          AND C.CATEGORYID = 9  -- ‚úÖ 9Î≤à Ïπ¥ÌÖåÍ≥†Î¶¨Îßå!
    </select>

</mapper>