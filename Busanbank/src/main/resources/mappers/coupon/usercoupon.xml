<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.busanbank.mapper.UserCouponMapper">

    <!-- ðŸ”¥ Flutter APIìš©: ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í° ì¡°íšŒ -->
    <select id="selectAvailableCoupons" resultType="kr.co.busanbank.dto.UserCouponDTO">
        SELECT
            UC.USERCOUPONID as ucNo,
            UC.USERID       as userNo,
            UC.COUPONID     as couponNo,
            C.COUPONNAME    as couponName,
            C.RATEINCREASE  as bonusRate,
            NULL    as categoryId,
            UC.PRODUCTNO    as productNo,
            TO_CHAR(UC.ISSUEDDATE, 'YYYY-MM-DD') as expireDate,
            UC.STATUS       as status
        FROM USERCOUPON UC
                 INNER JOIN COUPON C ON UC.COUPONID = C.COUPONID
        WHERE UC.USERID = #{userNo}
          AND UC.STATUS = 'UNUSED'
        ORDER BY UC.ISSUEDDATE ASC
    </select>

    <select id="findByUserNo" resultType="kr.co.busanbank.dto.UserCouponDTO">
        SELECT
            UC.USERCOUPONID as ucNo,
            UC.USERID       as userNo,
            UC.COUPONID     as couponNo,
            C.COUPONNAME    as couponName,
            C.RATEINCREASE  as bonusRate,
            C.CATEGORYID    as categoryId,
            UC.PRODUCTNO    as productNo,
            TO_CHAR(UC.ISSUEDDATE, 'YYYY-MM-DD') as expireDate,
            UC.STATUS       as status
        FROM USERCOUPON UC
                 INNER JOIN COUPON C ON UC.COUPONID = C.COUPONID
        WHERE UC.USERID = #{userNo}
          AND UC.STATUS = 'UNUSED'
    </select>

</mapper>